{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/vendoring/index.ts"],"names":[],"mappings":"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","sourcesContent":["import chalk from 'chalk';\nimport Table from 'cli-table3';\nimport semver from 'semver';\n\nimport { link } from '../Formatter';\nimport logger from '../Logger';\nimport * as Npm from '../Npm';\nimport { getBundledVersionsAsync } from '../ProjectVersions';\nimport {\n  VendoringModulePlatformConfig,\n  VendoringProvider,\n  VendoringTargetModulesConfig,\n} from './types';\n\nconst VENDORING_PROVIDERS: Record<string, () => VendoringProvider> = {\n  ios: () => require('../vendoring/IosVendoring'),\n  android: () => require('../vendoring/AndroidVendoring'),\n};\n\n/**\n * Delegates vendoring process to platform's provider.\n */\nexport async function vendorPlatformAsync(\n  platform: string,\n  sourceDirectory: string,\n  targetDirectory: string,\n  modulePlatformConfig?: VendoringModulePlatformConfig\n) {\n  const provider = VENDORING_PROVIDERS[platform]?.();\n\n  if (!provider) {\n    throw new Error(`No vendoring provider for platform \"${platform}\".`);\n  }\n  await provider.vendorAsync(sourceDirectory, targetDirectory, modulePlatformConfig);\n}\n\n/**\n * Outputs a table with modules, their versions and status.\n */\nexport async function listAvailableVendoredModulesAsync(\n  modules: VendoringTargetModulesConfig,\n  onlyOutdated: boolean = false\n) {\n  const bundledNativeModules = await getBundledVersionsAsync();\n  const vendoredPackageNames = Object.keys(modules);\n  const packageViews: Npm.PackageViewType[] = await Promise.all(\n    vendoredPackageNames.map((packageName: string) => Npm.getPackageViewAsync(packageName))\n  );\n\n  const table = new Table({\n    head: ['Package name', 'Bundled', 'Latest', 'Up to date'],\n    colAligns: ['right', 'center', 'center', 'center'],\n  });\n\n  for (const packageName of vendoredPackageNames) {\n    const packageView = packageViews.shift();\n\n    if (!packageView) {\n      logger.error(`Couldn't get package view for ${chalk.green.bold(packageName)}.\\n`);\n      continue;\n    }\n\n    const bundledVersion = bundledNativeModules[packageName];\n    const latestVersion = packageView['dist-tags'].latest;\n    const isOutdated = !bundledVersion || semver.gtr(latestVersion, bundledVersion);\n\n    if (!onlyOutdated || isOutdated) {\n      const { source } = modules[packageName];\n\n      table.push([\n        link(chalk.bold.green(packageName), source),\n        (bundledVersion ? chalk.cyan : chalk.gray)(bundledVersion),\n        chalk.cyan(latestVersion),\n        isOutdated ? '❌' : '✅',\n      ]);\n    }\n  }\n  logger.log(table.toString());\n}\n\n/**\n * Returns an array of platforms that vendoring process is available for.\n */\nexport function getVendoringAvailablePlatforms(): string[] {\n  return Object.keys(VENDORING_PROVIDERS);\n}\n"]}